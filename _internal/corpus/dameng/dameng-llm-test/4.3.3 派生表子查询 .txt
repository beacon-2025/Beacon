-- 创建表 PRODUCTION.PRODUCT_CATEGORY
CREATE TABLE PRODUCTION.PRODUCT_CATEGORY (
    PRODUCT_CATEGORYID INT PRIMARY KEY,
    NAME VARCHAR(100)
);
-- 创建表 PRODUCTION.PRODUCT_SUBCATEGORY
CREATE TABLE PRODUCTION.PRODUCT_SUBCATEGORY (
    PRODUCT_SUBCATEGORYID INT PRIMARY KEY,
    PRODUCT_CATEGORYID INT,
    FOREIGN KEY (PRODUCT_CATEGORYID) REFERENCES PRODUCTION.PRODUCT_CATEGORY(PRODUCT_CATEGORYID)
);
-- 插入数据到 PRODUCTION.PRODUCT_CATEGORY
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (PRODUCT_CATEGORYID, NAME) VALUES (1, '小说');
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (PRODUCT_CATEGORYID, NAME) VALUES (2, '文学');
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (PRODUCT_CATEGORYID, NAME) VALUES (3, '计算机');
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (PRODUCT_CATEGORYID, NAME) VALUES (4, '英语');
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (PRODUCT_CATEGORYID, NAME) VALUES (5, '管理');
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (PRODUCT_CATEGORYID, NAME) VALUES (6, '少儿');
-- 插入数据到 PRODUCTION.PRODUCT_SUBCATEGORY
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (1, 1);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (2, 1);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (3, 2);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (4, 2);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (5, 3);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (6, 3);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (7, 4);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (8, 5);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (9, 6);
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, PRODUCT_CATEGORYID) VALUES (10, 6);
-- 查询每个目录的编号、名称和对应的子目录的数量，并按数量递减排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.NUM DESC;
-- 查询每个目录的编号、名称和对应的子目录的数量，并按数量递增排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.SUBCATEGORY_COUNT 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS SUBCATEGORY_COUNT 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.SUBCATEGORY_COUNT ASC;
-- 查询每个目录的编号、名称和对应的子目录的数量，并按目录编号递增排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T1.PRODUCT_CATEGORYID ASC;
-- 查询子目录数量大于2的目录的编号、名称和对应的子目录的数量，并按数量递减排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID 
     HAVING COUNT(PRODUCT_SUBCATEGORYID) > 2) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.NUM DESC;
-- 使用 JOIN 查询每个目录的编号、名称和对应的子目录的数量，并按数量递减排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1 
JOIN (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
      FROM PRODUCTION.PRODUCT_SUBCATEGORY 
      GROUP BY PRODUCT_CATEGORYID) AS T2 
ON T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.NUM DESC;
-- 查询每个目录的编号、名称和对应的子目录的数量，并按数量递减排列，使用 DISTINCT 去重
SELECT DISTINCT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.NUM DESC;
-- 查询每个目录的编号、名称和对应的子目录的数量，并按数量递减排列，限制返回前3条记录
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.NUM DESC 
LIMIT 3;
-- 查询每个目录的编号、名称和对应的子目录的数量，并按目录名称递增排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T1.NAME ASC;
-- 查询每个目录的编号、名称和对应的子目录的数量，并按目录编号递增排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T1.PRODUCT_CATEGORYID ASC;
-- 查询子目录数量大于2的目录的编号、名称和对应的子目录的数量，并按数量递减排列
SELECT T1.PRODUCT_CATEGORYID, T1.NAME, T2.NUM 
FROM PRODUCTION.PRODUCT_CATEGORY T1, 
    (SELECT PRODUCT_CATEGORYID, COUNT(PRODUCT_SUBCATEGORYID) AS NUM 
     FROM PRODUCTION.PRODUCT_SUBCATEGORY 
     GROUP BY PRODUCT_CATEGORYID 
     HAVING COUNT(PRODUCT_SUBCATEGORYID) > 2) AS T2 
WHERE T1.PRODUCT_CATEGORYID = T2.PRODUCT_CATEGORYID 
ORDER BY T2.NUM DESC