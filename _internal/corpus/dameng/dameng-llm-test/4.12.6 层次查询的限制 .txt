-- 创建部门表
CREATE TABLE DEPARTMENT (
    HIGH_DEP VARCHAR(50),
    DEP_NAME VARCHAR(50) PRIMARY KEY
);
-- 插入部门数据
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES (NULL, '总公司');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '服务部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '采购部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '财务部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('服务部', '网络服务部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('服务部', '读者服务部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('读者服务部', '书籍借阅服务部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('读者服务部', '书籍阅览服务部');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('服务部', '企业服务部');
SELECT HIGH_DEP, DEP_NAME FROM DEPARTMENT CONNECT BY PRIOR DEP_NAME = HIGH_DEP;
SELECT HIGH_DEP, DEP_NAME FROM DEPARTMENT CONNECT BY PRIOR DEP_NAME = HIGH_DEP START WITH DEP_NAME = '总公司';
SELECT LEVEL, 
       CONNECT_BY_ISLEAF ISLEAF, 
       CONNECT_BY_ISCYCLE ISCYCLE, 
       HIGH_DEP, DEP_NAME 
FROM DEPARTMENT  
CONNECT BY PRIOR DEP_NAME = HIGH_DEP  
START WITH DEP_NAME = '总公司';
SELECT LEVEL, HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
WHERE HIGH_DEP = '总公司' 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP;
SELECT HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司' 
ORDER BY HIGH_DEP;
SELECT HIGH_DEP, DEP_NAME, LEVEL 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司' 
ORDER SIBLINGS BY DEP_NAME;
SELECT CONNECT_BY_ROOT DEP_NAME, HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
SELECT SYS_CONNECT_BY_PATH(DEP_NAME, '/') PATH, HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 插入一个长部门名称
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '这是一个非常长的部门名称，用于测试SYS_CONNECT_BY_PATH函数的最大返回长度');
-- 查询并测试SYS_CONNECT_BY_PATH函数
SELECT SYS_CONNECT_BY_PATH(DEP_NAME, '/') PATH, HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 插入多个部门数据以测试SYS_CONNECT_BY_PATH函数的最大使用个数
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '部门1');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '部门2');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '部门3');
-- ... 插入更多部门数据 ...

-- 查询并测试SYS_CONNECT_BY_PATH函数的最大使用个数
SELECT SYS_CONNECT_BY_PATH(DEP_NAME, '/') PATH, HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 设置INI参数CNNTB_MAX_LEVEL为100000
ALTER SYSTEM SET CNNTB_MAX_LEVEL = 100000;
-- 查询层次结构
SELECT HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 插入多层部门数据以测试层次查询的最大层次
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('总公司', '部门A');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('部门A', '部门B');
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('部门B', '部门C');
-- ... 插入更多部门数据 ...

-- 查询层次结构
SELECT HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 插入循环数据
INSERT INTO DEPARTMENT (HIGH_DEP, DEP_NAME) VALUES ('部门C', '部门A');
-- 查询层次结构并检测循环
SELECT LEVEL, 
       CONNECT_BY_ISCYCLE ISCYCLE, 
       HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 查询层次结构并检测叶子节点
SELECT LEVEL, 
       CONNECT_BY_ISLEAF ISLEAF, 
       HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司';
-- 查询多级层次结构
SELECT HIGH_DEP, DEP_NAME 
FROM DEPARTMENT 
CONNECT BY PRIOR DEP_NAME = HIGH_DEP 
START WITH DEP_NAME = '总公司'