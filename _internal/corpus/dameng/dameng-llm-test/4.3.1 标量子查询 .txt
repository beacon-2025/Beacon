-- 创建必要的表
CREATE TABLE PERSON.ADDRESS (
    ADDRESSID INT PRIMARY KEY,
    ADDRESS1 VARCHAR(100),
    CITY VARCHAR(50)
);
CREATE TABLE PERSON.ADDRESS_TYPE (
    ADDRESS_TYPEID INT PRIMARY KEY,
    TYPE_NAME VARCHAR(50)
);
CREATE TABLE SALES.SALESORDER_DETAIL (
    SALESORDERID INT PRIMARY KEY,
    ORDERQTY INT
);
CREATE TABLE SALES.CUSTOMER (
    CUSTOMERID INT PRIMARY KEY,
    CUSTOMERNAME VARCHAR(100)
);
CREATE TABLE PRODUCTION.PRODUCT (
    PRODUCTID INT PRIMARY KEY,
    PUBLISHER VARCHAR(100)
);
CREATE TABLE PURCHASING.VENDOR (
    VENDORID INT PRIMARY KEY,
    NAME VARCHAR(100)
);
CREATE TABLE PRODUCTION.PRODUCT_VENDOR (
    PRODUCTID INT,
    VENDORID INT,
    STANDARDPRICE DECIMAL(10, 2),
    PRIMARY KEY (PRODUCTID, VENDORID)
);
CREATE TABLE PRODUCTION.PRODUCT_CATEGORY (
    CATEGORYID INT PRIMARY KEY,
    NAME VARCHAR(100)
);
CREATE TABLE PRODUCTION.PRODUCT_SUBCATEGORY (
    PRODUCT_SUBCATEGORYID INT PRIMARY KEY,
    NAME VARCHAR(100)
);
-- 插入一些测试数据
INSERT INTO PERSON.ADDRESS (ADDRESSID, ADDRESS1, CITY) VALUES (1, '123 Main St', 'New York');
INSERT INTO PERSON.ADDRESS_TYPE (ADDRESS_TYPEID, TYPE_NAME) VALUES (1, 'Home');
INSERT INTO SALES.SALESORDER_DETAIL (SALESORDERID, ORDERQTY) VALUES (1, 10);
INSERT INTO SALES.CUSTOMER (CUSTOMERID, CUSTOMERNAME) VALUES (1, 'John Doe');
INSERT INTO PRODUCTION.PRODUCT (PRODUCTID, PUBLISHER) VALUES (5, 'Publisher A');
INSERT INTO PURCHASING.VENDOR (VENDORID, NAME) VALUES (2, 'Vendor B');
INSERT INTO PRODUCTION.PRODUCT_VENDOR (PRODUCTID, VENDORID, STANDARDPRICE) VALUES (1, 2, 100.00);
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (CATEGORYID, NAME) VALUES (1, 'Category A');
INSERT INTO PRODUCTION.PRODUCT_SUBCATEGORY (PRODUCT_SUBCATEGORYID, NAME) VALUES (40, 'Subcategory A');
-- 测试用例 1: 标量子查询返回单行单列
SELECT 'VALUE IS', (SELECT ADDRESS1 FROM PERSON.ADDRESS WHERE ADDRESSID = 1) 
FROM PERSON.ADDRESS_TYPE;
-- 测试用例 2: 函数 + 标量子查询
SELECT 'VALUE IS', LEFT((SELECT ADDRESS1 FROM PERSON.ADDRESS WHERE ADDRESSID = 1), 8) 
FROM PERSON.ADDRESS_TYPE;
-- 测试用例 3: 标量子查询返回多列，预期报错
SELECT 'VALUE IS', (SELECT ADDRESS1, CITY FROM PERSON.ADDRESS WHERE ADDRESSID = 1) 
FROM PERSON.ADDRESS_TYPE;
-- 测试用例 4: 标量子查询返回多行，预期报错
SELECT 'VALUE IS', (SELECT ADDRESS1 FROM PERSON.ADDRESS) 
FROM PERSON.ADDRESS_TYPE;
-- 测试用例 5: 标量子查询返回空值
DELETE FROM SALES.SALESORDER_DETAIL;
SELECT 'VALUE IS', (SELECT ORDERQTY FROM SALES.SALESORDER_DETAIL) 
FROM SALES.CUSTOMER;
-- 测试用例 6: UPDATE 语句中使用标量子查询
UPDATE PRODUCTION.PRODUCT SET PUBLISHER = 
(SELECT NAME FROM PURCHASING.VENDOR WHERE VENDORID = 2) 
WHERE PRODUCTID = 5;
-- 测试用例 7: UPDATE 语句中使用标量子查询计算平均值
UPDATE PRODUCTION.PRODUCT_VENDOR SET STANDARDPRICE = 
(SELECT AVG(STANDARDPRICE) FROM PRODUCTION.PRODUCT_VENDOR) 
WHERE PRODUCTID = 1;
-- 测试用例 8: INSERT 语句中使用标量子查询
INSERT INTO PRODUCTION.PRODUCT_CATEGORY (CATEGORYID, NAME) VALUES 
(2, (SELECT NAME FROM PRODUCTION.PRODUCT_SUBCATEGORY WHERE PRODUCT_SUBCATEGORYID = 40));
-- 测试用例 9: 查询通常价格最小的供应商的名称和最小价格
SELECT NAME, (SELECT MIN(STANDARDPRICE) 
               FROM PRODUCTION.PRODUCT_VENDOR T1 
               WHERE T1.VENDORID = T2.VENDORID) 
FROM PURCHASING.VENDOR T2