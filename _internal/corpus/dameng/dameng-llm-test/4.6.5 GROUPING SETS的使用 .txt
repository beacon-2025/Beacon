-- 创建表 PERSON.ADDRESS
CREATE TABLE PERSON.ADDRESS (
    CITY VARCHAR(50),
    ADDRESS1 VARCHAR(100),
    POSTALCODE VARCHAR(10)
);
-- 插入测试数据
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1, POSTALCODE) VALUES
('武汉市洪山区', '洪山区 369号金地太阳城', '430073'),
('武汉市洪山区', '洪山区 369号金地太阳城', '430073'),
('武汉市洪山区', '洪山区保利花园', '430080'),
('武汉市洪山区', '洪山区关山春晓', '430063'),
('武汉市青山区', '青山区青翠苑 1号', '430050'),
('武汉市武昌区', '武昌区武船新村 115号', '430023'),
('武汉市汉阳区', '汉阳大道熊家湾 15号', '430023'),
('武汉市江汉区', '江汉区发展大道 561号', '430023');
-- 按照 CITY 和 ADDRESS1 分组，以及单独按照 POSTALCODE 分组
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((CITY, ADDRESS1), POSTALCODE);
-- 按照 CITY 和 ADDRESS1 分组，以及一个空分组项
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((CITY, ADDRESS1), ());
-- 按照 CITY 分组，按照 ADDRESS1 分组，以及按照 POSTALCODE 分组
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS (CITY, ADDRESS1, POSTALCODE);
-- 按照 (CITY, ADDRESS1) 和 (CITY, POSTALCODE) 分组
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((CITY, ADDRESS1), (CITY, POSTALCODE));
-- 按照 (CITY, ADDRESS1), (ADDRESS1, POSTALCODE), 和 (CITY, POSTALCODE) 分组
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((CITY, ADDRESS1), (ADDRESS1, POSTALCODE), (CITY, POSTALCODE));
-- 按照 (CITY, ADDRESS1), (POSTALCODE), 和空分组项分组
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((CITY, ADDRESS1), POSTALCODE, ());
-- 仅包含空分组项
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS (());
-- 包含多个空分组项
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((), ());
-- 包含多个分组项和空分组项
SELECT CITY, ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY GROUPING SETS ((CITY, ADDRESS1), (ADDRESS1, POSTALCODE), ());
-- 使用 UNION ALL 模拟 GROUPING SETS 的效果
SELECT CITY, ADDRESS1, NULL AS POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY CITY, ADDRESS1
UNION ALL
SELECT NULL AS CITY, NULL AS ADDRESS1, POSTALCODE, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY POSTALCODE