-- 创建表空间
CREATE TABLESPACE TS1 DATAFILE '/data/TS1.DBF' SIZE 128;
CREATE TABLESPACE TS2 DATAFILE '/data/TS2.DBF' SIZE 128;
CREATE TABLESPACE TS3 DATAFILE '/data/TS3.DBF' SIZE 128;
CREATE TABLESPACE TS4 DATAFILE '/data/TS4.DBF' SIZE 128;
-- 创建LIST-RANGE三级水平分区表
DROP TABLE IF EXISTS STUDENT;
CREATE TABLE STUDENT(
    NAME VARCHAR(20),
    AGE INT,
    SEX VARCHAR(10) CHECK (SEX IN ('MAIL','FEMAIL')),
    GRADE INT CHECK (GRADE IN (7,8,9))
)
PARTITION BY LIST(GRADE)
  SUBPARTITION BY LIST(SEX) SUBPARTITION TEMPLATE
  (
     SUBPARTITION Q1 VALUES('MAIL'),
     SUBPARTITION Q2 VALUES('FEMAIL')
  ),
  SUBPARTITION BY RANGE(AGE) SUBPARTITION TEMPLATE
  (
     SUBPARTITION R1 VALUES LESS THAN (12),
     SUBPARTITION R2 VALUES LESS THAN (15),
     SUBPARTITION R3 VALUES LESS THAN (MAXVALUE)
   )
(
  PARTITION P1 VALUES (7),
  PARTITION P2 VALUES (8),
  PARTITION P3 VALUES (9)
);
-- 查询水平分区父表
SELECT * FROM STUDENT;
-- 查询一级分区子表
SELECT * FROM STUDENT PARTITION(P1);
-- 查询二级分区子表
SELECT * FROM STUDENT SUBPARTITION(P1_Q1);
-- 查询三级分区子表
SELECT * FROM STUDENT SUBPARTITION(P1_Q1_R1);
-- 创建指定HASH分区名的水平分区表
DROP TABLE IF EXISTS CP_TABLE_HASH;
CREATE TABLE CP_TABLE_HASH(
   C1  INT,
   C2  VARCHAR(256),
   C3  DATETIME,
   C4  BLOB
)
PARTITION BY HASH (C1)
SUBPARTITION BY HASH(C2)
SUBPARTITION TEMPLATE
(
    SUBPARTITION PAR1 STORAGE (ON MAIN),
    SUBPARTITION PAR2 STORAGE (ON TS1),
    SUBPARTITION PAR3 STORAGE (ON TS2),
    SUBPARTITION PAR4
)
(
    PARTITION PAR1 STORAGE (ON MAIN),
    PARTITION PAR2 STORAGE (ON TS1),
    PARTITION PAR3 STORAGE (ON TS2),
    PARTITION PAR4
)
STORAGE (ON TS4);
-- 查询一级分区子表
SELECT * FROM CP_TABLE_HASH PARTITION(PAR1);
-- 查询二级分区子表
SELECT * FROM CP_TABLE_HASH SUBPARTITION(PAR1_PAR1);
-- 创建指定HASH分区数的水平分区表
DROP TABLE IF EXISTS CP_TABLE_HASH01;
CREATE TABLE CP_TABLE_HASH01(
   C1  INT,
   C2  VARCHAR(256),
   C3  DATETIME,
   C4  BLOB
)
PARTITION BY HASH (C1)
PARTITIONS 4 STORE IN (TS1, TS2, TS3, TS4);
-- 查询一级分区子表
SELECT * FROM CP_TABLE_HASH01 PARTITION (DMHASHPART0);
-- 插入数据到LIST-RANGE三级水平分区表
INSERT INTO STUDENT (NAME, AGE, SEX, GRADE) VALUES ('Alice', 10, 'MAIL', 7);
INSERT INTO STUDENT (NAME, AGE, SEX, GRADE) VALUES ('Bob', 13, 'FEMAIL', 8);
INSERT INTO STUDENT (NAME, AGE, SEX, GRADE) VALUES ('Charlie', 16, 'MAIL', 9);
-- 查询插入的数据
SELECT * FROM STUDENT;
-- 删除数据从LIST-RANGE三级水平分区表
DELETE FROM STUDENT WHERE NAME = 'Alice';
-- 查询删除后的数据
SELECT * FROM STUDENT;
-- 更新数据在LIST-RANGE三级水平分区表
UPDATE STUDENT SET AGE = 14 WHERE NAME = 'Bob';
-- 查询更新后的数据
SELECT * FROM STUDENT;
-- 查询HASH分区表的二级分区
SELECT * FROM CP_TABLE_HASH SUBPARTITION(PAR1_PAR2);
-- 查询HASH分区表的三级分区
SELECT * FROM CP_TABLE_HASH SUBPARTITION(PAR1_PAR1);
-- 查询HASH分区表的匿名分区
SELECT * FROM CP_TABLE_HASH01 PARTITION (DMHASHPART1);
-- 查询HASH分区表的所有分区
SELECT * FROM CP_TABLE_HASH01