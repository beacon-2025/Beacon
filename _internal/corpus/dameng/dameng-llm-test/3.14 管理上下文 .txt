-- 创建一个测试表
CREATE TABLE test_table1 (
    id NUMBER PRIMARY KEY,
    name VARCHAR2(50)
);
-- 插入一些测试数据
INSERT INTO test_table1 (id, name) VALUES (1, 'Alice');
INSERT INTO test_table1 (id, name) VALUES (2, 'Bob');
-- 测试用例 1: 设置和访问上下文
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Alice');
END;
/
SELECT SYS_CONTEXT('USER_CONTEXT', 'USER_NAME') AS USER_NAME FROM DUAL;
-- 测试用例 2: 使用上下文过滤数据
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Bob');
END;
/
SELECT * FROM test_table1 WHERE name = SYS_CONTEXT('USER_CONTEXT', 'USER_NAME');
-- 测试用例 3: 设置多个上下文值
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Charlie');
DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_ROLE', 'Admin');
END;
/
SELECT SYS_CONTEXT('USER_CONTEXT', 'USER_NAME') AS USER_NAME,
       SYS_CONTEXT('USER_CONTEXT', 'USER_ROLE') AS USER_ROLE
FROM DUAL;
-- 测试用例 4: 清除上下文值
BEGIN
    DBMS_SESSION.CLEAR_CONTEXT('USER_CONTEXT', 'USER_NAME');
END;
/
SELECT SYS_CONTEXT('USER_CONTEXT', 'USER_NAME') AS USER_NAME FROM DUAL;
-- 测试用例 5: 清除整个上下文
BEGIN
    DBMS_SESSION.CLEAR_CONTEXT('USER_CONTEXT');
END;
/
SELECT SYS_CONTEXT('USER_CONTEXT', 'USER_NAME') AS USER_NAME,
       SYS_CONTEXT('USER_CONTEXT', 'USER_ROLE') AS USER_ROLE
FROM DUAL;
-- 测试用例 6: 使用上下文在查询中
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Alice');
END;
/
SELECT * FROM test_table1 WHERE name = SYS_CONTEXT('USER_CONTEXT', 'USER_NAME');
-- 测试用例 7: 使用上下文在插入语句中
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'David');
END;
/
INSERT INTO test_table1 (id, name) VALUES (3, SYS_CONTEXT('USER_CONTEXT', 'USER_NAME'));
-- 测试用例 8: 使用上下文在更新语句中
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Eve');
END;
/
UPDATE test_table1 SET name = SYS_CONTEXT('USER_CONTEXT', 'USER_NAME') WHERE id = 1;
-- 测试用例 9: 使用上下文在删除语句中
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Alice');
END;
/
DELETE FROM test_table1 WHERE name = SYS_CONTEXT('USER_CONTEXT', 'USER_NAME');
-- 测试用例 10: 使用上下文在复杂查询中
BEGIN
    DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_NAME', 'Bob');
DBMS_SESSION.SET_CONTEXT('USER_CONTEXT', 'USER_ROLE', 'User');
END;
/
SELECT * FROM test_table1 
WHERE name = SYS_CONTEXT('USER_CONTEXT', 'USER_NAME')
AND id = (SELECT id FROM test_table1 WHERE name = SYS_CONTEXT('USER_CONTEXT', 'USER_NAME'))