-- 公共前置语句：创建基表和视图
CREATE TABLE PURCHASING.VENDOR (
    VENDORID INT PRIMARY KEY,
    NAME VARCHAR(100),
    ACTIVEFLAG INT
);
CREATE TABLE PRODUCTION.PRODUCT (
    PRODUCTID INT PRIMARY KEY,
    NAME VARCHAR(100)
);
CREATE TABLE PRODUCTION.PRODUCT_VENDOR (
    PRODUCTID INT,
    VENDORID INT,
    STANDARDPRICE DECIMAL(10, 4),
    PRIMARY KEY (PRODUCTID, VENDORID)
);
CREATE VIEW PURCHASING.VENDOR_EXCELLENT AS
SELECT VENDORID, NAME
FROM PURCHASING.VENDOR
WHERE ACTIVEFLAG = 1;
-- 插入测试数据
INSERT INTO PURCHASING.VENDOR (VENDORID, NAME, ACTIVEFLAG) VALUES
(1, '北京十月文艺出版社', 1),
(2, '人民邮电出版社', 0),
(3, '清华大学出版社', 1),
(4, '中华书局', 1),
(5, '广州出版社', 1),
(6, '上海出版社', 1),
(7, '21世纪出版社', 1),
(8, '外语教学与研究出版社', 1),
(9, '机械工业出版社', 1),
(10, '文学出版社', 1);
INSERT INTO PRODUCTION.PRODUCT (PRODUCTID, NAME) VALUES
(1, '红楼梦'),
(2, '水浒传'),
(3, '老人与海'),
(4, '射雕英雄传(全四册)'),
(5, '数据结构(C语言版)(附光盘)'),
(6, '突破英文基础词汇'),
(7, '噼里啪啦丛书(全 7册)'),
(8, '工作中无小事');
INSERT INTO PRODUCTION.PRODUCT_VENDOR (PRODUCTID, VENDORID, STANDARDPRICE) VALUES
(1, 4, 25.0000),
(2, 4, 25.0000),
(3, 6, 25.0000),
(4, 5, 25.0000),
(5, 3, 25.0000),
(6, 8, 25.0000),
(7, 7, 25.0000),
(8, 9, 25.0000);
-- 测试用例 1: 从视图 VENDOR_EXCELLENT 中查询 ACTIVEFLAG 为 1 的供应商的编号和名称
SELECT VENDORID, NAME
FROM PURCHASING.VENDOR_EXCELLENT
WHERE ACTIVEFLAG = 1;
-- 测试用例 2: 查询信誉等级为 1 的供应商供应的图书编号、名称、通常价格和供应商名称
SELECT T1.PRODUCTID, T1.NAME, T2.STANDARDPRICE, T3.NAME
FROM PRODUCTION.PRODUCT T1
JOIN PRODUCTION.PRODUCT_VENDOR T2 ON T1.PRODUCTID = T2.PRODUCTID
JOIN PURCHASING.VENDOR_EXCELLENT T3 ON T2.VENDORID = T3.VENDORID;
-- 测试用例 3: 查询所有供应商的名称和状态
SELECT NAME, ACTIVEFLAG
FROM PURCHASING.VENDOR;
-- 测试用例 4: 查询所有产品的名称和价格
SELECT P.NAME, PV.STANDARDPRICE
FROM PRODUCTION.PRODUCT P
JOIN PRODUCTION.PRODUCT_VENDOR PV ON P.PRODUCTID = PV.PRODUCTID;
-- 测试用例 5: 查询所有供应商的名称及其供应的产品数量
SELECT V.NAME, COUNT(PV.PRODUCTID) AS ProductCount
FROM PURCHASING.VENDOR V
LEFT JOIN PRODUCTION.PRODUCT_VENDOR PV ON V.VENDORID = PV.VENDORID
GROUP BY V.NAME;
-- 测试用例 6: 查询所有产品的名称及其供应商的名称
SELECT P.NAME AS ProductName, V.NAME AS VendorName
FROM PRODUCTION.PRODUCT P
JOIN PRODUCTION.PRODUCT_VENDOR PV ON P.PRODUCTID = PV.PRODUCTID
JOIN PURCHASING.VENDOR V ON PV.VENDORID = V.VENDORID;
-- 测试用例 7: 查询所有供应商的名称及其供应的产品名称
SELECT V.NAME AS VendorName, P.NAME AS ProductName
FROM PURCHASING.VENDOR V
JOIN PRODUCTION.PRODUCT_VENDOR PV ON V.VENDORID = PV.VENDORID
JOIN PRODUCTION.PRODUCT P ON PV.PRODUCTID = P.PRODUCTID;
-- 测试用例 8: 查询所有产品的名称及其供应商的名称，按产品名称排序
SELECT P.NAME AS ProductName, V.NAME AS VendorName
FROM PRODUCTION.PRODUCT P
JOIN PRODUCTION.PRODUCT_VENDOR PV ON P.PRODUCTID = PV.PRODUCTID
JOIN PURCHASING.VENDOR V ON PV.VENDORID = V.VENDORID
ORDER BY P.NAME;
-- 测试用例 9: 查询所有供应商的名称及其供应的产品数量，按产品数量降序排列
SELECT V.NAME, COUNT(PV.PRODUCTID) AS ProductCount
FROM PURCHASING.VENDOR V
LEFT JOIN PRODUCTION.PRODUCT_VENDOR PV ON V.VENDORID = PV.VENDORID
GROUP BY V.NAME
ORDER BY ProductCount DESC;
-- 测试用例 10: 查询所有产品的名称及其供应商的名称，过滤掉没有供应商的产品
SELECT P.NAME AS ProductName, V.NAME AS VendorName
FROM PRODUCTION.PRODUCT P
JOIN PRODUCTION.PRODUCT_VENDOR PV ON P.PRODUCTID = PV.PRODUCTID
JOIN PURCHASING.VENDOR V ON PV.VENDORID = V.VENDORID
WHERE V.VENDORID IS NOT NULL