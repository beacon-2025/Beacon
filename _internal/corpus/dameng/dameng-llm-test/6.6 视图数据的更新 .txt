-- 创建基表 VENDOR
CREATE TABLE PURCHASING.VENDOR (
    VENDORID INT PRIMARY KEY,
    NAME VARCHAR(100),
    ACTIVEFLAG INT,
    CREDIT INT,
    WEBURL VARCHAR(200)
);
-- 创建基表 PRODUCT_VENDOR
CREATE TABLE PURCHASING.PRODUCT_VENDOR (
    PRODUCTID INT PRIMARY KEY,
    VENDORID INT,
    FOREIGN KEY (VENDORID) REFERENCES PURCHASING.VENDOR(VENDORID)
);
-- 创建可更新视图 VENDOR_EXCELLENT
CREATE VIEW PURCHASING.VENDOR_EXCELLENT AS
SELECT VENDORID, NAME, ACTIVEFLAG, CREDIT
FROM PURCHASING.VENDOR
WHERE CREDIT = 1;
-- 创建不可更新视图 VENDOR_STATIS
CREATE VIEW PRODUCTION.VENDOR_STATIS AS
SELECT VENDORID, COUNT(PRODUCTID) AS PRODUCT_COUNT
FROM PURCHASING.PRODUCT_VENDOR
GROUP BY VENDORID;
-- 测试用例 1: 更新视图 VENDOR_EXCELLENT 中的记录
UPDATE PURCHASING.VENDOR_EXCELLENT
SET ACTIVEFLAG = 0
WHERE NAME = '人民邮电出版社';
-- 测试用例 2: 插入新记录到视图 VENDOR_EXCELLENT
INSERT INTO PURCHASING.VENDOR_EXCELLENT (VENDORID, NAME, ACTIVEFLAG, CREDIT)
VALUES (1, '电子工业出版社', 1, 1);
-- 测试用例 3: 从视图 VENDOR_EXCELLENT 中删除记录
DELETE FROM PURCHASING.VENDOR_EXCELLENT
WHERE NAME = '中华书局';
-- 测试用例 4: 尝试更新不可更新视图 VENDOR_STATIS
-- 预期结果: 报错，因为视图不可更新
UPDATE PRODUCTION.VENDOR_STATIS
SET PRODUCT_COUNT = 3
WHERE VENDORID = 5;
-- 测试用例 5: 创建物化视图
CREATE MATERIALIZED VIEW PURCHASING.VENDOR_MATERIALIZED AS
SELECT VENDORID, NAME, ACTIVEFLAG, CREDIT
FROM PURCHASING.VENDOR
WHERE CREDIT = 1;
-- 测试用例 6: 手动刷新物化视图
REFRESH MATERIALIZED VIEW PURCHASING.VENDOR_MATERIALIZED;
-- 测试用例 7: 尝试在不可更新视图上创建视图
-- 预期结果: 报错，因为视图不可更新
CREATE VIEW PRODUCTION.VENDOR_STATIS_VIEW AS
SELECT VENDORID, PRODUCT_COUNT
FROM PRODUCTION.VENDOR_STATIS;
-- 测试用例 8: 尝试在视图上使用 WITH CHECK OPTION
-- 预期结果: 报错，因为视图不可更新
CREATE VIEW PURCHASING.VENDOR_EXCELLENT_CHECK AS
SELECT VENDORID, NAME, ACTIVEFLAG, CREDIT
FROM PURCHASING.VENDOR
WHERE CREDIT = 1
WITH CHECK OPTION;
-- 测试用例 9: 尝试在视图上插入不符合条件的记录
-- 预期结果: 报错，因为视图有 WITH CHECK OPTION
INSERT INTO PURCHASING.VENDOR_EXCELLENT_CHECK (VENDORID, NAME, ACTIVEFLAG, CREDIT)
VALUES (2, '机械工业出版社', 1, 0);
-- 测试用例 10: 尝试删除基表中的记录，但引用表中存在相关记录
-- 预期结果: 报错，因为引用表中存在相关记录
DELETE FROM PURCHASING.VENDOR
WHERE NAME = '中华书局'