-- 创建表 PERSON.ADDRESS
CREATE TABLE PERSON.ADDRESS (
    CITY VARCHAR(50),
    ADDRESS1 VARCHAR(100)
);
-- 插入测试数据
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区 369号金地太阳城 56-1-202');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区 369号金地太阳城 57-2-302');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区保利花园 50-1-304');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区保利花园 51-1-702');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区关山春晓 51-1-702');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区关山春晓 55-1-202');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区关山春晓 10-1-202');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区关山春晓 11-1-202');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市洪山区', '洪山区光谷软件园 C1_501');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市青山区', '青山区青翠苑 1号');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市武昌区', '武昌区武船新村 115号');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市武昌区', '武昌区武船新村 1号');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市汉阳区', '汉阳大道熊家湾 15号');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市江汉区', '江汉区发展大道 561号');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市江汉区', '江汉区发展大道 555号');
INSERT INTO PERSON.ADDRESS (CITY, ADDRESS1) VALUES ('武汉市江汉区', '江汉区发展大道 423号');
-- 使用 GROUPING_ID 统计员工居住分布情况
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) AS G_CA, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1);
-- 使用 GROUPING_ID 过滤结果集，只显示未分组的行
SELECT CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1)
HAVING GROUPING_ID(CITY, ADDRESS1) = 0;
-- 使用 GROUPING_ID 进行表达式运算
SELECT CITY, ADDRESS1, COUNT(*) AS NUMS, GROUPING_ID(CITY, ADDRESS1) + 1 AS G_CA_PLUS_1
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1);
-- 使用 GROUPING_ID 与多个列
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) AS G_CA, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1);
-- 使用 GROUPING_ID 与单个列
SELECT GROUPING(CITY) AS G_CITY, GROUPING_ID(CITY) AS G_CA, CITY, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY);
-- 使用 GROUPING_ID 与 NULL 值
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) AS G_CA, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1)
HAVING GROUPING_ID(CITY, ADDRESS1) = 1;
-- 使用 GROUPING_ID 与多个分组项
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) AS G_CA, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1);
-- 使用 GROUPING_ID 与复杂表达式
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) * 2 AS G_CA_DOUBLE, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1);
-- 使用 GROUPING_ID 与多个 ROLLUP
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) AS G_CA, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY), ROLLUP(ADDRESS1);
-- 使用 GROUPING_ID 与多个分组项和复杂表达式
SELECT GROUPING(CITY) AS G_CITY, GROUPING(ADDRESS1) AS G_ADD, GROUPING_ID(CITY, ADDRESS1) + GROUPING_ID(ADDRESS1, CITY) AS G_CA_SUM, CITY, ADDRESS1, COUNT(*) AS NUMS
FROM PERSON.ADDRESS
GROUP BY ROLLUP(CITY, ADDRESS1)